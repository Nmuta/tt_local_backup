<mat-chip-list (change)="onChipListChange($event)">
  <mat-chip
    *ngFor="let identity of augmentedIdentities"
    #chip="matChip"
    [value]="identity"
    [class.identity-valid]="identity.extra.isValid"
    [class.identity-invalid]="!identity.extra.isValid"
    [color]="identity.extra.theme"
    (click)="chip.toggleSelected(true)"
  >
    <ng-container *ngTemplateOutlet="template; context: { $implicit: identity }"></ng-container>
  </mat-chip>
</mat-chip-list>
