<div class="steward-layout-with-sidebar">
  <div class="steward-layout-sidebar-group">
    <racers-cup-inputs (playerAndDaysForward)="refreshTable($event)"></racers-cup-inputs>
  </div>
  <ng-container *ngIf="!getMonitor.isActive; else loading">
    <div class="steward-layout-pane steward-layout-main-group">
      <mat-card>
        <mat-card-title>Racer's Cup Schedule</mat-card-title>

        <div class="calendar-header">
          <div>
            <button mat-raised-button mwlCalendarPreviousView [view]="view" [(viewDate)]="viewDate">
              Previous
            </button>
            <button mat-raised-button mwlCalendarToday [(viewDate)]="viewDate">Today</button>
            <button mat-raised-button mwlCalendarNextView [view]="view" [(viewDate)]="viewDate">
              Next
            </button>
          </div>
          <div>
            <h2>{{ viewDate | calendarDate: view + 'ViewTitle':'en' }}</h2>
          </div>
          <div>
            <button
              mat-raised-button
              (click)="setView(CalendarView.Month)"
              [class.active]="view === CalendarView.Month"
            >
              Month
            </button>
            <button
              mat-raised-button
              (click)="setView(CalendarView.Week)"
              [class.active]="view === CalendarView.Week"
            >
              Week
            </button>
            <button
              mat-raised-button
              (click)="setView(CalendarView.Day)"
              [class.active]="view === CalendarView.Day"
            >
              Day
            </button>
          </div>
        </div>
        <br />
        <div class="calendar-view-switch" [ngSwitch]="view">
          <mwl-calendar-month-view
            *ngSwitchCase="CalendarView.Month"
            [viewDate]="viewDate"
            [events]="events"
            [cellTemplate]="customDayCellTemplate"
            (beforeViewRender)="beforeMonthViewRender($event)"
          >
          </mwl-calendar-month-view>
          <mwl-calendar-week-view
            *ngSwitchCase="CalendarView.Week"
            [viewDate]="viewDate"
            [events]="events"
            [eventTemplate]="weekEventTemplate"
          >
          </mwl-calendar-week-view>
          <mwl-calendar-day-view
            *ngSwitchCase="CalendarView.Day"
            [viewDate]="viewDate"
            [events]="events"
            [eventTemplate]="dayEventTemplate"
          >
          </mwl-calendar-day-view>
        </div>
      </mat-card>
    </div>
  </ng-container>
</div>

<ng-template #customDayCellTemplate let-day="day" let-locale="locale">
  <div class="cal-cell-top">
    <span class="cal-day-badge" *ngIf="day.badgeTotal > 0">{{ day.badgeTotal }}</span>
    <span class="cal-day-number">{{ day.date | calendarDate: 'monthViewDayNumber':locale }}</span>
  </div>
  <div class="cell-totals">
    <div class="shrink-wrap">
      <div
        *ngFor="let group of day.eventGroups"
        class="badge badge-{{ getGroupIndex(group[0]) }}"
        (click)="groupClicked(group)"
        matTooltip="{{ group[0] }}"
      >
        {{ group[0] }}: {{ group[1].length }}
      </div>
    </div>
  </div>
</ng-template>

<!-- "weekEvent" comes from Angular Calendar and cannot be changed -->
<ng-template
  #dayEventTemplate
  let-dayEvent="weekEvent"
  let-tooltipPlacement="tooltipPlacement"
  let-eventClicked="eventClicked"
  let-tooltipTemplate="tooltipTemplate"
  let-tooltipAppendToBody="tooltipAppendToBody"
  let-tooltipDisabled="tooltipDisabled"
  let-tooltipDelay="tooltipDelay"
  let-column="column"
  let-daysInWeek="daysInWeek"
  let-locale="locale"
>
  <div
    class="cal-event day-view-event"
    [mwlCalendarTooltip]="!tooltipDisabled ? dayEvent.event.meta.weekTooltip : ''"
    [tooltipPlacement]="tooltipPlacement"
    [tooltipEvent]="dayEvent.tempEvent || dayEvent.event"
    [tooltipTemplate]="tooltipTemplate"
    [tooltipAppendToBody]="tooltipAppendToBody"
    [tooltipDelay]="tooltipDelay"
  >
    <div class="badge day-event-badge badge-{{ getGroupIndex(dayEvent.event.meta.seriesName) }}">
      {{ dayEvent.event.meta.eventNameClean }}
    </div>
  </div>
</ng-template>

<ng-template
  #weekEventTemplate
  let-weekEvent="weekEvent"
  let-tooltipPlacement="tooltipPlacement"
  let-eventClicked="eventClicked"
  let-tooltipTemplate="tooltipTemplate"
  let-tooltipAppendToBody="tooltipAppendToBody"
  let-tooltipDisabled="tooltipDisabled"
  let-tooltipDelay="tooltipDelay"
  let-column="column"
  let-daysInWeek="daysInWeek"
  let-locale="locale"
>
  <div
    class="cal-event week-view-event"
    [mwlCalendarTooltip]="!tooltipDisabled ? weekEvent.event.meta.weekTooltip : ''"
    [tooltipPlacement]="tooltipPlacement"
    [tooltipEvent]="weekEvent.event"
    [tooltipTemplate]="tooltipTemplate"
    [tooltipAppendToBody]="tooltipAppendToBody"
    [tooltipDelay]="tooltipDelay"
  ></div>
</ng-template>

<ng-template #loading>
  <big-spinner [monitor]="getMonitor"></big-spinner>
</ng-template>
