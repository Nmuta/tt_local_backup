<h5 *ngIf="useExpandoColumnDef">* Click on a row to expand its details.</h5>

<table mat-table [dataSource]="ugcTableDataSource" multiTemplateDataRows #matTable>
  <ng-container matColumnDef="ugcInfo">
    <th mat-header-cell *matHeaderCellDef>UGC Info</th>
    <td mat-cell *matCellDef="let entry">
      <ul>
        <li>
          <b>Featured:</b>
          {{ entry.featuredByT10 ? (entry.featuredEndDateUtc | utcDate: 'short') : 'No' }}
        </li>
        <li><b>Title:</b> {{ entry.title }}</li>
        <li><b>Description:</b> {{ entry.description }}</li>
        <li><b>Created:</b> {{ entry.createdDateUtc | utcDate: 'short' }}</li>
      </ul>
    </td>
  </ng-container>

  <ng-container matColumnDef="metadata">
    <th mat-header-cell *matHeaderCellDef>Metadata</th>
    <td mat-cell *matCellDef="let entry">
      <ul>
        <li><b>Access Level:</b> {{ entry.isPublic ? 'Public' : 'Private' }}</li>
        <li><b>Car:</b> {{ entry.carDescription }}</li>
        <li><b>Share Code:</b> {{ entry.shareCode || 'N/A' }}</li>
        <li><b>Id:</b> {{ entry.id }}</li>
      </ul>
    </td>
  </ng-container>

  <ng-container matColumnDef="stats">
    <th mat-header-cell *matHeaderCellDef>Stats</th>
    <td mat-cell *matCellDef="let entry">
      <ul>
        <li><b>Popularity:</b> {{ entry.popularityBucket }}/5</li>
        <li><b>Likes:</b> {{ entry.timesLiked }}</li>
        <li><b>Dislikes:</b> {{ entry.timesDisliked }}</li>
        <li><b>Downloads:</b> {{ entry.timesDownloaded }}</li>
        <li><b>Uses:</b> {{ entry.timesUsed }}</li>
      </ul>
    </td>
  </ng-container>

  <ng-container matColumnDef="thumbnailOneImageBase64">
    <th mat-header-cell *matHeaderCellDef>Thumbnail One</th>
    <td mat-cell *matCellDef="let entry">
      <img
        *ngIf="!!entry?.thumbnailOneImageBase64"
        matTooltip="Click to enlarge image"
        [src]="entry.thumbnailOneImageBase64"
        [enlargeImage]="entry.thumbnailOneImageBase64"
        title="Thumbnail One"
      />
      <span *ngIf="!entry.thumbnailOneImageBase64">N/A</span>
    </td>
  </ng-container>

  <ng-container matColumnDef="thumbnailTwoImageBase64">
    <th mat-header-cell *matHeaderCellDef>Thumbnail Two</th>
    <td mat-cell *matCellDef="let entry">
      <img
        *ngIf="!!entry?.thumbnailTwoImageBase64"
        matTooltip="Click to enlarge image"
        [src]="entry.thumbnailTwoImageBase64"
        [enlargeImage]="entry.thumbnailTwoImageBase64"
        title="Thumbnail Two"
      />
      <span *ngIf="!entry.thumbnailTwoImageBase64">N/A</span>
    </td>
  </ng-container>

  <ng-container matColumnDef="actions">
    <th mat-header-cell *matHeaderCellDef>Actions</th>
    <td mat-cell *matCellDef="let entry">
      <div class="inline-buttons">
        <a
          mat-stroked-button
          color="primary"
          clickStop
          [routerLink]="entry.ugcDetailsLink"
          [disabled]="!ugcDetailsLinkSupported || !entry.ugcDetailsLink"
        >
          <span
            [matTooltip]="
              ugcDetailsLinkSupported
                ? 'Go to UGC details page for this item'
                : 'UGC details page is not supported for this title'
            "
            >View Full Details</span
          >
        </a>
        <button
          mat-stroked-button
          color="primary"
          clickStop
          [cdkCopyToClipboard]="entry.id"
          class="ignore-min-size"
          matTooltip="Copy the UGC item's id"
        >
          <mat-icon>content_copy</mat-icon> Id
        </button>
      </div>

      <button
        *ngIf="supportFeaturing"
        mat-raised-button
        color="accent"
        clickStop
        (click)="openFeatureUgcModal(entry)"
        [disabled]="!entry.isPublic || !canFeatureUgc"
      >
        <span
          [matTooltip]="
            canFeatureUgc ? privateFeaturingDisabledTooltip : invalidRoleDisabledTooltip
          "
          [matTooltipDisabled]="entry.isPublic && canFeatureUgc"
          >{{ entry.featuredByT10 ? 'Edit Featured Status' : 'Set Featured Status' }}</span
        >
      </button>

      <div *ngIf="supportHiding" class="hide-score">
        <button
          mat-raised-button
          color="warn"
          matTooltip="Hide this UGC"
          [verifyWith]="verifyHide"
          (click)="hideUgcItem(entry)"
          clickStop
          stateManager
          [monitor]="entry.monitor"
          [waitOnMonitors]="allMonitors"
          monitorWarn
          monitorWarnSnackbar
          monitorCompleteSnackbar
          [disabled]="!canHideUgc || entry.monitor.isActive"
        >
          <span [matTooltip]="invalidRoleDisabledTooltip" [matTooltipDisabled]="canHideUgc"
            >Hide UGC</span
          >
        </button>
        <mat-checkbox clickStop #verifyHide matTooltip="Check to enable hide UGC.">
          Verify
        </mat-checkbox>
      </div>
    </td>
  </ng-container>

  <ng-container matColumnDef="exando-ugcInfo">
    <th mat-header-cell *matHeaderCellDef>UGC Info</th>
    <td mat-cell *matCellDef="let entry">
      <ul>
        <li>
          <b>Featured:</b>
          {{ entry.featuredByT10 ? (entry.featuredEndDateUtc | utcDate: 'short') : 'No' }}
        </li>
        <li><b>Title:</b> {{ entry.title }}</li>
        <li><b>Description:</b> {{ entry.description }}</li>
        <li><b>Created:</b> {{ entry.createdDateUtc | utcDate: 'short' }}</li>
        <li><b>Car:</b> {{ entry.carDescription }}</li>
      </ul>
    </td>
  </ng-container>

  <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
  <ng-container matColumnDef="expandedDetail">
    <td mat-cell *matCellDef="let entry" [attr.colspan]="columnsToDisplay.length">
      <div
        class="example-element-detail"
        [@detailExpand]="entry === expandedElement ? 'expanded' : 'collapsed'"
      >
        <ul>
          <div>
            <li><b>Id:</b> {{ entry.id }}</li>
            <li><b>Share Code:</b> {{ entry.shareCode || 'N/A' }}</li>
            <li><b>Popularity:</b> {{ entry.popularityBucket }}/5</li>
            <li><b>Likes:</b> {{ entry.timesLiked }}</li>
            <li><b>Dislikes:</b> {{ entry.timesDisliked }}</li>
            <li><b>Downloads:</b> {{ entry.timesDownloaded }}</li>
            <li><b>Uses:</b> {{ entry.timesUsed }}</li>
          </div>
          <div *ngIf="entry.thumbnailTwoImageBase64">
            <li>
              <b>Thumbnail Two:</b><br />
              <img
                matTooltip="Click to enlarge image"
                [src]="entry.thumbnailTwoImageBase64"
                [enlargeImage]="entry.thumbnailTwoImageBase64"
                title="Thumbnail Two"
              />
            </li>
          </div>
        </ul>
      </div>
    </td>
  </ng-container>

  <tr
    mat-header-row
    *matHeaderRowDef="useExpandoColumnDef ? expandoColumnDef : columnsToDisplay"
  ></tr>
  <tr
    [hidden]="waitingForThumbnails"
    mat-row
    *matRowDef="let element; columns: useExpandoColumnDef ? expandoColumnDef : columnsToDisplay"
    class="example-element-row"
    [class.example-expanded-row]="expandedElement === element"
    [class.border-bottom]="!useExpandoColumnDef"
    [class.cursor-pointer]="useExpandoColumnDef"
    [class.is-featured-item]="element.featuredByT10"
    (click)="expandedElement = expandedElement !== element ? element : null"
  ></tr>
  <ng-container *ngIf="useExpandoColumnDef">
    <tr
      [hidden]="waitingForThumbnails"
      mat-row
      *matRowDef="let row; columns: ['expandedDetail']"
      class="example-detail-row"
    ></tr>
  </ng-container>
</table>
<mat-paginator
  [pageSizeOptions]="[5, 10, 20]"
  (page)="getUgcThumbnailsForActiveDataset()"
  showFirstLastButtons
></mat-paginator>
<mat-progress-spinner *ngIf="waitingForThumbnails" mode="indeterminate"></mat-progress-spinner>
